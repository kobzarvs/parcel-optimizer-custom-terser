{"mappings":";;;;;IA2BA,wCA0DG,GA1DY,GAAG,CAAC,gBAAS,CAAC,CAAC;UACtB,QAAQ,EAAC,IAAI,EAAyB,CAAC;QAC3C,KAAK,CAAC,CAAC,SACL,MAAM,aACN,QAAQ,QACR,GAAG,WACH,MAAM,IACR,CAAC,GAAG,IAAI;QAER,MAAM,CAAC,IAAI,CAAC,CAAC;YAAA,OAAO,GAAG,mBAAmB,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;QAAC,CAAC;QAE3D,KAAK,CAAC,aAAa,GAAkB,CAAC;YACpC,QAAQ,EAAE,KAAK;YACf,IAAI,EAAE,IAAI;YACV,GAAG,EAAE,KAAK;YACV,eAAe,EAAE,SAAS;YAC1B,WAAW,EAAE,KAAK;YAClB,MAAM,EAAE,IAAI;YACZ,QAAQ,EAAE,KAAK;YACf,SAAS,EAAE,CAAC;gBACV,cAAc,EAAE,IAAI;gBACpB,QAAQ,EAAE,MAAM,CAAC,IAAI;gBACrB,GAAG,EAAE,MAAM,CAAC,IAAI,GAAG,CAAM;YAC3B,CAAC;YACD,QAAQ,EAAE,IAAI;QAChB,CAAC;QAED,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,aAAM,CAAC,QAAQ,EAAY,aAAa;QAC7D,EAAsE,AAAtE,oEAAsE;QAEtE,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG;QACpC,OAAO,CAAC,GAAG,CAAC,CAAY,aAAE,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,GAAG;QAEvD,EAAE,EAAE,GAAG,EAAE,CAAC;YACR,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,KAAK;YACrB,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAClB,QAAQ,EAAE,MAAM,CAAC,QAAQ;gBACzB,KAAK,EAAE,MAAM,CAAC,KAAK;YACrB,CAAC;YACD,GAAG,CAAC,SAAS,CAAC,GAAG;QAEjB,EAAiB,AAAjB,eAAiB;QACjB,EAAgB,AAAhB,cAAgB;QAChB,EAA6C,AAA7C,2CAA6C;QAC7C,EAAoC,AAApC,kCAAoC;QACpC,EAA+B,AAA/B,6BAA+B;QAC/B,EAA6D,AAA7D,2DAA6D;QAC7D,EAAQ,AAAR,MAAQ;QACR,EAAsC,AAAtC,oCAAsC;QACtC,EAAe,AAAf,aAAe;QACf,EAAI,AAAJ,EAAI;QACN,CAAC;QAED,MAAM,CAAC,CAAC;iBACN,GAAG;YACH,QAAQ,EAAE,MAAM,CAAC,IAAI;QACvB,CAAC;IACH,CAAC;AACH,CAAC","sources":["packages/parcel-optimizer-custom-terser/src/index.ts"],"sourcesContent":["import {Optimizer} from '@parcel/plugin';\nimport {\n  CompressOptions,\n  ECMA,\n  FormatOptions,\n  MangleOptions, ManglePropertiesOptions,\n  minify,\n  MinifyOptions,\n  ParseOptions, SimpleIdentifierMangler,\n  SourceMapOptions, WeightedIdentifierMangler,\n} from 'terser';\nimport SourceMap from '@parcel/source-map';\nimport {Async, Blob, BundleGraph, BundleResult, NamedBundle, PluginLogger, PluginOptions} from '@parcel/types';\nimport {RawSourceMap} from 'source-map';\n\n\ninterface OptimizeArgs<ConfigType> {\n  bundle: NamedBundle;\n  bundleGraph: BundleGraph<NamedBundle>;\n  contents: Blob;\n  map: SourceMap | null | undefined;\n  options: PluginOptions;\n  logger: PluginLogger;\n  config: ConfigType;\n  getSourceMapReference: (map: SourceMap | null | undefined) => Async<string | null | undefined>;\n}\n\nexport default new Optimizer({\n  async optimize(args): Promise<BundleResult> {\n    const {\n      bundle,\n      contents,\n      map,\n      logger,\n    } = args;\n\n    logger.info({message: `processing bundle '${bundle.name}'`});\n\n    const minifyOptions: MinifyOptions = {\n      compress: false, //boolean | CompressOptions;\n      ecma: 2020,\n      ie8: false,\n      keep_classnames: undefined,\n      keep_fnames: false,\n      module: true,\n      safari10: false,\n      sourceMap: {\n        includeSources: true,\n        filename: bundle.name,\n        url: bundle.name + '.map',\n      },\n      toplevel: true,\n    };\n\n    const result = await minify(contents as string, minifyOptions);\n    // const result = await minify(contents as string, {sourceMap: true});\n\n    const rawMap = JSON.parse(result.map as string) as RawSourceMap;\n    console.log('result.map', typeof result.map, result.map);\n\n    if (map) {\n      const vlq = map.toVLQ();\n      Object.assign(vlq, {\n        mappings: rawMap.mappings,\n        names: rawMap.names\n      });\n      map.addVLQMap(vlq);\n\n      // let sourceMap;\n      // if (rawMap) {\n      //   sourceMap = SourceMap.generateEmptyMap({\n      //     projectRoot: vlq.sourceRoot!,\n      //     sourceName: bundle.name,\n      //     sourceContent: rawMap.sourcesContent?.join('\\n') || ''\n      //   });\n      //   sourceMap.addNames(rawMap.names);\n      //   sourceMap.\n      // }\n    }\n\n    return {\n      map,\n      contents: result.code as string,\n    };\n  },\n});\n"],"names":[],"version":3,"file":"index.es.js.map"}